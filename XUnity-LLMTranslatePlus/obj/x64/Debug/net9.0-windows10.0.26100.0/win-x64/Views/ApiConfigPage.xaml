<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="XUnity_LLMTranslatePlus.Views.ApiConfigPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:XUnity_LLMTranslatePlus.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <ScrollViewer Padding="0,0,16,0" HorizontalScrollBarVisibility="Disabled">
        <StackPanel Spacing="16" Margin="0,0,0,24" HorizontalAlignment="Stretch">
            <!-- 页面标题 -->
            <TextBlock Text="API 配置" Style="{StaticResource TitleTextBlockStyle}"/>

            <!-- 基础配置 -->
            <Expander Header="基础配置" IsExpanded="True" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                <StackPanel Spacing="12" Margin="0,12,0,0" HorizontalAlignment="Stretch">
                    <!-- API 平台 -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="API 平台"/>
                        <ComboBox x:ConnectionId='29' x:Name="ApiPlatformComboBox" 
                                  SelectedIndex="0" 
                                  HorizontalAlignment="Stretch"
                                                                                         >
                            <ComboBoxItem Content="OpenAI"/>
                            <ComboBoxItem Content="Azure OpenAI"/>
                            <ComboBoxItem Content="Anthropic Claude"/>
                            <ComboBoxItem Content="Google Gemini"/>
                            <ComboBoxItem Content="DeepSeek"/>
                            <ComboBoxItem Content="Moonshot"/>
                            <ComboBoxItem Content="智谱GLM"/>
                            <ComboBoxItem Content="Ollama"/>
                            <ComboBoxItem Content="自定义"/>
                        </ComboBox>
                    </StackPanel>

                    <!-- API 地址 -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="API 地址"/>
                        <TextBox x:ConnectionId='28' x:Name="ApiUrlTextBox" 
                                 PlaceholderText="https://api.openai.com/v1/chat/completions"
                                 Text="https://api.openai.com/v1/chat/completions"
                                 HorizontalAlignment="Stretch"/>
                    </StackPanel>

                    <!-- API 密钥 -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="API 密钥"/>
                        <PasswordBox x:ConnectionId='27' x:Name="ApiKeyPasswordBox" 
                                     PlaceholderText="输入您的 API 密钥"
                                     HorizontalAlignment="Stretch"/>
                    </StackPanel>

                    <!-- 模型名称 -->
                    <StackPanel Spacing="4">
                        <Grid>
                            <TextBlock Text="模型名称" HorizontalAlignment="Left" VerticalAlignment="Center"/>
                            <Button x:ConnectionId='26' x:Name="RefreshModelsButton" 
                                    Content="刷新列表" 
                                    HorizontalAlignment="Right"
                                                                     
                                    FontSize="12"
                                    Padding="8,4">
                                <Button.Resources>
                                    <ResourceDictionary>
                                        <Thickness x:Key="ButtonPadding">8,4</Thickness>
                                    </ResourceDictionary>
                                </Button.Resources>
                            </Button>
                        </Grid>
                        <ComboBox x:ConnectionId='25' x:Name="ModelNameComboBox" 
                                  IsEditable="True"
                                  HorizontalAlignment="Stretch">
                            <ComboBoxItem Content="gpt-3.5-turbo"/>
                            <ComboBoxItem Content="gpt-4"/>
                            <ComboBoxItem Content="gpt-4-turbo"/>
                            <ComboBoxItem Content="claude-3-sonnet"/>
                            <ComboBoxItem Content="gemini-pro"/>
                        </ComboBox>
                    </StackPanel>

                    <!-- 测试连接按钮 -->
                    <Button x:ConnectionId='24' Style="{StaticResource AccentButtonStyle}"
                                                              >
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE895;" FontSize="16"/>
                            <TextBlock Text="测试连接"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Expander>

            <!-- 高级配置 -->
            <Expander Header="高级配置" IsExpanded="False" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                <StackPanel Spacing="12" Margin="0,12,0,0" HorizontalAlignment="Stretch">
                    <!-- 最大令牌数 -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="最大令牌数"/>
                        <NumberBox x:ConnectionId='23' x:Name="MaxTokensNumberBox" 
                                   Value="2000" 
                                   Minimum="1" 
                                   Maximum="32000"
                                   SpinButtonPlacementMode="Inline"/>
                    </StackPanel>

                    <!-- 温度 -->
                    <StackPanel Spacing="4">
                        <Grid>
                            <TextBlock Text="温度" HorizontalAlignment="Left"/>
                            <TextBlock x:ConnectionId='22' x:Name="TemperatureValueText" 
                                       Text="0.7" 
                                       HorizontalAlignment="Right"/>
                        </Grid>
                        <Slider x:ConnectionId='21' x:Name="TemperatureSlider" 
                                Minimum="0" 
                                Maximum="2" 
                                StepFrequency="0.1" 
                                Value="0.7"
                                                                             />
                    </StackPanel>

                    <!-- Top P -->
                    <StackPanel Spacing="4">
                        <Grid>
                            <TextBlock Text="Top P" HorizontalAlignment="Left"/>
                            <TextBlock x:ConnectionId='20' x:Name="TopPValueText" 
                                       Text="1.0" 
                                       HorizontalAlignment="Right"/>
                        </Grid>
                        <Slider x:ConnectionId='19' x:Name="TopPSlider" 
                                Minimum="0" 
                                Maximum="1" 
                                StepFrequency="0.1" 
                                Value="1.0"
                                                                      />
                    </StackPanel>

                    <!-- 频率惩罚 -->
                    <StackPanel Spacing="4">
                        <Grid>
                            <TextBlock Text="频率惩罚" HorizontalAlignment="Left"/>
                            <TextBlock x:ConnectionId='18' x:Name="FrequencyPenaltyValueText" 
                                       Text="0.0" 
                                       HorizontalAlignment="Right"/>
                        </Grid>
                        <Slider x:ConnectionId='17' x:Name="FrequencyPenaltySlider" 
                                Minimum="-2" 
                                Maximum="2" 
                                StepFrequency="0.1" 
                                Value="0.0"
                                                                                  />
                    </StackPanel>

                    <!-- 存在惩罚 -->
                    <StackPanel Spacing="4">
                        <Grid>
                            <TextBlock Text="存在惩罚" HorizontalAlignment="Left"/>
                            <TextBlock x:ConnectionId='16' x:Name="PresencePenaltyValueText" 
                                       Text="0.0" 
                                       HorizontalAlignment="Right"/>
                        </Grid>
                        <Slider x:ConnectionId='15' x:Name="PresencePenaltySlider" 
                                Minimum="-2" 
                                Maximum="2" 
                                StepFrequency="0.1" 
                                Value="0.0"
                                                                                 />
                    </StackPanel>

                    <!-- 超时时间 -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="超时时间（秒）"/>
                        <NumberBox x:ConnectionId='14' x:Name="TimeoutNumberBox" 
                                   Value="30" 
                                   Minimum="5" 
                                   Maximum="300"
                                   SpinButtonPlacementMode="Inline"/>
                    </StackPanel>

                    <!-- 重试次数 -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="重试次数"/>
                        <NumberBox x:ConnectionId='13' x:Name="RetryCountNumberBox" 
                                   Value="3" 
                                   Minimum="1" 
                                   Maximum="10"
                                   SpinButtonPlacementMode="Inline"/>
                    </StackPanel>
                </StackPanel>
            </Expander>

            <!-- 并发配置 -->
            <Expander Header="并发配置" IsExpanded="False" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                <StackPanel Spacing="12" Margin="0,12,0,0" HorizontalAlignment="Stretch">
                    <!-- 最大并发翻译数 -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="最大并发翻译数" 
                                   ToolTipService.ToolTip="同时发送给API翻译的文本数量，建议根据API速率限制调整"/>
                        <NumberBox x:ConnectionId='12' x:Name="MaxConcurrentTranslationsNumberBox" 
                                   Value="3" 
                                   Minimum="1" 
                                   Maximum="20"
                                   SpinButtonPlacementMode="Inline"/>
                    </StackPanel>
                </StackPanel>
            </Expander>

            <!-- 系统提示词 -->
            <Expander Header="系统提示词" IsExpanded="False" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                <StackPanel Spacing="12" Margin="0,12,0,0" HorizontalAlignment="Stretch">
                    <!-- 提示词变量说明 -->
                    <InfoBar Severity="Informational" 
                             IsOpen="True" 
                             IsClosable="False"
                             Message="可用变量：{目标语言}、{原文}、{术语}、{上下文}"/>

                    <!-- 提示词模板 -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="提示词模板"/>
                        <TextBox x:ConnectionId='11' x:Name="SystemPromptTextBox" 
                                 AcceptsReturn="True" 
                                 TextWrapping="Wrap" 
                                 Height="180"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 HorizontalAlignment="Stretch"
                                 Text="你是一个专业的游戏文本翻译助手。请将以下文本翻译成{目标语言}。保持原文的语气和风格，确保翻译准确、流畅、自然。&#xA;&#xA;【重要】如果文本中包含形如【SPECIAL_数字】的占位符，请务必在译文中完整保留这些占位符，不要翻译或修改它们。&#xA;&#xA;原文：{原文}&#xA;&#xA;术语参考：{术语}&#xA;&#xA;上下文参考：{上下文}&#xA;&#xA;请只输出翻译结果，不要包含任何解释或额外内容。"/>
                    </StackPanel>

                    <!-- 重置按钮 -->
                    <Button x:ConnectionId='10' Content="重置为默认"                                />
                </StackPanel>
            </Expander>

            <!-- 术语库 -->
            <Expander Header="术语库" IsExpanded="False" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                <StackPanel Spacing="12" Margin="0,12,0,0" HorizontalAlignment="Stretch">
                    <!-- 工具栏 -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <Button x:ConnectionId='6'                            >
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE710;" FontSize="14"/>
                                <TextBlock Text="添加"/>
                            </StackPanel>
                        </Button>
                        <Button x:ConnectionId='7'                               >
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE74D;" FontSize="14"/>
                                <TextBlock Text="删除"/>
                            </StackPanel>
                        </Button>
                        <Button x:ConnectionId='8'                                >
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE8B5;" FontSize="14"/>
                                <TextBlock Text="导入"/>
                            </StackPanel>
                        </Button>
                        <Button x:ConnectionId='9'                                >
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xEDE1;" FontSize="14"/>
                                <TextBlock Text="导出"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <!-- 术语表 -->
                    <ListView x:ConnectionId='3' x:Name="TermsListView" 
                              Height="200" 
                              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                              BorderThickness="1"
                              CornerRadius="4"
                              SelectionMode="Single">
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                <Setter Property="Padding" Value="0"/>
                            </Style>
                        </ListView.ItemContainerStyle>
                        <ListView.HeaderTemplate>
                            <DataTemplate>
                                <Grid Padding="16,8" MinHeight="40">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="3*" MinWidth="150"/>
                                        <ColumnDefinition Width="3*" MinWidth="150"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="原文" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                    <TextBlock Grid.Column="1" Text="译文" FontWeight="SemiBold" VerticalAlignment="Center" Margin="12,0,0,0"/>
                                    <TextBlock Grid.Column="2" Text="优先级" FontWeight="SemiBold" TextAlignment="Center" VerticalAlignment="Center"/>
                                    <TextBlock Grid.Column="3" Text="启用" FontWeight="SemiBold" TextAlignment="Center" VerticalAlignment="Center"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.HeaderTemplate>
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="16,12" MinHeight="48">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="3*" MinWidth="150"/>
                                        <ColumnDefinition Width="3*" MinWidth="150"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Grid.Column="0" 
                                             Text="{Binding Original, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                             VerticalAlignment="Center"
                                             PlaceholderText="原文"
                                             BorderThickness="1"/>
                                    <TextBox Grid.Column="1" 
                                             Text="{Binding Translation, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                             VerticalAlignment="Center"
                                             PlaceholderText="译文"
                                             BorderThickness="1"
                                             Margin="12,0,0,0"/>
                                    <NumberBox Grid.Column="2" 
                                               Value="{Binding Priority, Mode=TwoWay}" 
                                               HorizontalAlignment="Stretch"
                                               Minimum="1"
                                               Maximum="100"
                                               SpinButtonPlacementMode="Compact"
                                               Margin="12,0,0,0"/>
                                    <CheckBox Grid.Column="3" 
                                              IsChecked="{Binding Enabled, Mode=TwoWay}" 
                                              HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"
                                              MinWidth="0"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </StackPanel>
            </Expander>

            <!-- 保存按钮 -->
            <Button x:ConnectionId='2' Style="{StaticResource AccentButtonStyle}"
                                                  
                    HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon Glyph="&#xE74E;" FontSize="16"/>
                    <TextBlock Text="保存配置"/>
                </StackPanel>
            </Button>
        </StackPanel>
    </ScrollViewer>
</Page>


