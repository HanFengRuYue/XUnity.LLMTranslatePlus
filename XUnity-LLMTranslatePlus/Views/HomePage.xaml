<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="XUnity_LLMTranslatePlus.Views.HomePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:XUnity_LLMTranslatePlus.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Loaded="Page_Loaded">

    <ScrollViewer Padding="0,0,16,0">
        <StackPanel Spacing="24" Margin="0,0,0,24">
            <!-- 页面标题 -->
            <TextBlock Text="主页" Style="{StaticResource TitleTextBlockStyle}"/>

            <!-- 当前监控的文件路径 -->
            <Border x:Name="FilePathBorder"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="16"
                    Visibility="Collapsed">
                <StackPanel Spacing="4">
                    <TextBlock Text="监控文件"
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    <TextBlock x:Name="FilePathText"
                               Text=""
                               TextWrapping="Wrap"
                               IsTextSelectionEnabled="True"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Style="{StaticResource CaptionTextBlockStyle}"/>
                </StackPanel>
            </Border>

            <!-- 信息提示栏 -->
            <InfoBar
                x:Name="StatusInfoBar"
                Title="欢迎使用 XUnity大语言模型翻译Plus"
                Message="请先在 API 配置页面配置您的 API 设置，然后在翻译设置页面选择游戏目录。"
                Severity="Informational"
                IsOpen="True"
                IsClosable="True"/>

            <!-- 状态和统计卡片 -->
            <Grid ColumnSpacing="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- 当前状态卡片 -->
                <Border Grid.Column="0" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                        BorderThickness="1" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="8">
                        <TextBlock Text="当前状态" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                        <TextBlock x:Name="StatusText" Text="已停止" 
                                   Style="{StaticResource SubtitleTextBlockStyle}" 
                                   Foreground="{ThemeResource SystemFillColorCriticalBrush}"/>
                    </StackPanel>
                </Border>

                <!-- 已翻译卡片 -->
                <Border Grid.Column="1" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                        BorderThickness="1" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="8">
                        <TextBlock Text="已翻译" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                        <TextBlock x:Name="TranslatedCountText" Text="0" 
                                   Style="{StaticResource SubtitleTextBlockStyle}" 
                                   Foreground="{ThemeResource SystemFillColorSuccessBrush}"/>
                    </StackPanel>
                </Border>

                <!-- 待翻译卡片 -->
                <Border Grid.Column="2" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                        BorderThickness="1" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="8">
                        <TextBlock Text="待翻译" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                        <TextBlock x:Name="PendingCountText" Text="0" 
                                   Style="{StaticResource SubtitleTextBlockStyle}" 
                                   Foreground="{ThemeResource SystemFillColorAttentionBrush}"/>
                    </StackPanel>
                </Border>

                <!-- API处理中卡片 -->
                <Border Grid.Column="3" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="8">
                        <TextBlock Text="API处理中" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                        <TextBlock x:Name="QueueCountText" Text="0"
                                   Style="{StaticResource SubtitleTextBlockStyle}"
                                   Foreground="{ThemeResource SystemFillColorAttentionBrush}"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- 快速操作区域 -->
            <StackPanel Spacing="16">
                <TextBlock Text="快速操作" Style="{StaticResource SubtitleTextBlockStyle}"/>

                <StackPanel Orientation="Horizontal" Spacing="12">
                    <Button x:Name="StartStopButton"
                            Content="开始翻译"
                            Style="{StaticResource AccentButtonStyle}"
                            Click="StartStopButton_Click"
                            MinWidth="140">
                        <Button.KeyboardAccelerators>
                            <KeyboardAccelerator Key="F5"/>
                        </Button.KeyboardAccelerators>
                    </Button>

                    <Button Click="OpenGameDirButton_Click">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE8B7;" FontSize="16"/>
                            <TextBlock Text="打开游戏目录"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </StackPanel>

            <!-- 自动刷新设置 -->
            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="16">
                <StackPanel Spacing="12">
                    <TextBlock Text="自动刷新游戏翻译"
                               Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    <TextBlock Text="定期向游戏发送 ALT+R 组合键以刷新翻译显示"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               TextWrapping="Wrap"/>

                    <StackPanel Orientation="Horizontal" Spacing="16">
                        <ToggleSwitch x:Name="AutoRefreshToggle"
                                      Header="启用自动刷新"
                                      IsEnabled="False"
                                      Toggled="AutoRefreshToggle_Toggled"/>

                        <StackPanel Spacing="4" VerticalAlignment="Bottom">
                            <TextBlock Text="刷新间隔（秒）"
                                       Style="{StaticResource CaptionTextBlockStyle}"/>
                            <NumberBox x:Name="AutoRefreshIntervalBox"
                                       Minimum="1"
                                       Maximum="60"
                                       Value="5"
                                       SpinButtonPlacementMode="Inline"
                                       SmallChange="1"
                                       LargeChange="5"
                                       Width="120"
                                       ValueChanged="AutoRefreshIntervalBox_ValueChanged"/>
                        </StackPanel>
                    </StackPanel>

                    <InfoBar Severity="Informational"
                             Message="⚠️ 需要先启动翻译监控才能使用此功能。按键将发送到前台窗口，请确保游戏窗口在最前面。"
                             IsOpen="True"
                             IsClosable="False"/>
                </StackPanel>
            </Border>

            <!-- 最近翻译 -->
            <StackPanel Spacing="12">
                <TextBlock Text="最近翻译" Style="{StaticResource SubtitleTextBlockStyle}"/>
                
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                        BorderThickness="1" CornerRadius="8" Padding="0">
                    <ScrollViewer MaxHeight="400" VerticalScrollBarVisibility="Auto">
                        <ListView x:Name="RecentTranslationsListView" 
                                  SelectionMode="None"
                                  ItemsSource="{x:Bind RecentTranslations, Mode=OneWay}">
                            <!-- 禁用过渡动画 -->
                            <ListView.ItemContainerTransitions>
                                <TransitionCollection/>
                            </ListView.ItemContainerTransitions>
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="12,8" ColumnSpacing="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <FontIcon Grid.Column="0" 
                                                  Glyph="&#xE73E;" 
                                                  FontSize="16" 
                                                  Foreground="{ThemeResource SystemFillColorSuccessBrush}"/>
                                        
                                        <StackPanel Grid.Column="1" Spacing="4">
                                            <TextBlock Text="原文" 
                                                       Style="{StaticResource CaptionTextBlockStyle}" 
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                            <TextBlock Text="{Binding Key}" 
                                                       TextWrapping="Wrap" 
                                                       MaxLines="2"/>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Column="2" Spacing="4">
                                            <TextBlock Text="译文" 
                                                       Style="{StaticResource CaptionTextBlockStyle}" 
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                            <TextBlock Text="{Binding Value}" 
                                                       TextWrapping="Wrap" 
                                                       MaxLines="2"/>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </ScrollViewer>
                </Border>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</Page>

