<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="XUnity_LLMTranslatePlus.Views.TerminologyPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:XUnity_LLMTranslatePlus.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <ScrollViewer Padding="0,0,16,0" HorizontalScrollBarVisibility="Disabled">
        <StackPanel Spacing="16" Margin="0,0,0,24" HorizontalAlignment="Stretch">
            <!-- 页面标题 -->
            <TextBlock Text="术语库" Style="{StaticResource TitleTextBlockStyle}"/>

            <!-- 术语库文件管理 -->
            <Expander Header="术语库文件管理" IsExpanded="True" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                <StackPanel Spacing="12" Margin="0,12,0,0" HorizontalAlignment="Stretch">
                    <!-- 当前术语库 -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="当前术语库"/>
                        <Grid ColumnSpacing="8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <ComboBox x:Name="TerminologyFileComboBox"
                                      Grid.Column="0"
                                      HorizontalAlignment="Stretch"
                                      SelectionChanged="TerminologyFileComboBox_SelectionChanged"/>

                            <Button Grid.Column="1"
                                    Content="新建"
                                    Click="NewTerminologyButton_Click"/>

                            <Button Grid.Column="2"
                                    Content="另存为"
                                    Click="SaveAsTerminologyButton_Click"/>

                            <Button Grid.Column="3"
                                    Content="删除"
                                    Click="DeleteTerminologyButton_Click"/>
                        </Grid>
                    </StackPanel>
                </StackPanel>
            </Expander>

            <!-- 术语管理 -->
            <Expander Header="术语管理" IsExpanded="True" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                <StackPanel Spacing="12" Margin="0,12,0,0" HorizontalAlignment="Stretch">
                    <!-- 工具栏 -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <Button Click="AddTermButton_Click">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE710;" FontSize="14"/>
                                <TextBlock Text="添加"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="DeleteTermButton" Click="DeleteTermButton_Click" IsEnabled="False">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE74D;" FontSize="14"/>
                                <TextBlock Text="删除"/>
                            </StackPanel>
                        </Button>
                        <Button Click="SelectAllButton_Click">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE8B3;" FontSize="14"/>
                                <TextBlock Text="全选"/>
                            </StackPanel>
                        </Button>
                        <Button Click="DeselectAllButton_Click">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE8E6;" FontSize="14"/>
                                <TextBlock Text="取消全选"/>
                            </StackPanel>
                        </Button>
                        <Button Click="ImportTermsButton_Click">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE8B5;" FontSize="14"/>
                                <TextBlock Text="导入 CSV"/>
                            </StackPanel>
                        </Button>
                        <Button Click="ExportTermsButton_Click">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xEDE1;" FontSize="14"/>
                                <TextBlock Text="导出 CSV"/>
                            </StackPanel>
                        </Button>
                        <TextBlock x:Name="SelectionCountText"
                                   Text=""
                                   VerticalAlignment="Center"
                                   Margin="8,0,0,0"
                                   Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                    </StackPanel>

                    <!-- 术语表 -->
                    <ListView x:Name="TermsListView"
                              Height="500"
                              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                              BorderThickness="1"
                              CornerRadius="4"
                              SelectionMode="Extended"
                              SelectionChanged="TermsListView_SelectionChanged">
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                <Setter Property="Padding" Value="0"/>
                            </Style>
                        </ListView.ItemContainerStyle>
                        <ListView.HeaderTemplate>
                            <DataTemplate>
                                <Grid Padding="16,8" MinHeight="40">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="3*" MinWidth="150"/>
                                        <ColumnDefinition Width="3*" MinWidth="150"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="原文" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                    <TextBlock Grid.Column="1" Text="译文" FontWeight="SemiBold" VerticalAlignment="Center" Margin="12,0,0,0"/>
                                    <TextBlock Grid.Column="2" Text="启用" FontWeight="SemiBold" TextAlignment="Center" VerticalAlignment="Center"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.HeaderTemplate>
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="16,12" MinHeight="48">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="3*" MinWidth="150"/>
                                        <ColumnDefinition Width="3*" MinWidth="150"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Grid.Column="0"
                                             Text="{Binding Original, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             VerticalAlignment="Center"
                                             PlaceholderText="原文"
                                             BorderThickness="1"
                                             TextChanged="TermTextBox_TextChanged"/>
                                    <TextBox Grid.Column="1"
                                             Text="{Binding Translation, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             VerticalAlignment="Center"
                                             PlaceholderText="译文"
                                             BorderThickness="1"
                                             Margin="12,0,0,0"
                                             TextChanged="TermTextBox_TextChanged"/>
                                    <CheckBox Grid.Column="2"
                                              IsChecked="{Binding Enabled, Mode=TwoWay}"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"
                                              MinWidth="0"
                                              Checked="TermCheckBox_Changed"
                                              Unchecked="TermCheckBox_Changed"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </StackPanel>
            </Expander>

            <!-- 智能术语提取 -->
            <Expander Header="智能术语提取" IsExpanded="False" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                <StackPanel Spacing="12" Margin="0,12,0,0" HorizontalAlignment="Stretch">
                    <!-- 启用开关 -->
                    <ToggleSwitch x:Name="EnableSmartTerminologyToggle"
                                  Header="启用智能术语提取"
                                  IsOn="False"
                                  OnContent="已启用"
                                  OffContent="已禁用"
                                  Toggled="EnableSmartTerminologyToggle_Toggled"/>

                    <InfoBar Severity="Informational"
                             IsOpen="True"
                             IsClosable="False"
                             Message="启用后会在翻译过程中自动识别并添加游戏中的人名、地名、技能名等专有名词到术语库。注意：这会增加 API 调用次数和成本。"/>
                </StackPanel>
            </Expander>

            <!-- 自动保存提示 -->
            <InfoBar Severity="Informational"
                     IsOpen="True"
                     IsClosable="False"
                     Message="所有术语更改将自动保存"/>
        </StackPanel>
    </ScrollViewer>
</Page>
